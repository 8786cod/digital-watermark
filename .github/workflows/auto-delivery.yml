name: Auto Watermark Delivery
on:
  issues:
    types: [opened]
jobs:
  deliver-verification-report:
    if: contains(github.event.issue.title, '[WATERMARK]')
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      - name: Add Verification Comment
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const timestamp = Date.now();
            const repo = `${context.repo.owner}/${context.repo.repo}`;
            const watermark = `GH:${repo}-${timestamp.toString().slice(-6)}`;
            const hash = require('crypto').createHash('md5').update(watermark).digest('hex');
            const verifyUrl = `https://your-repo.netlify.app/verify?watermark=${watermark}`;
            const reportId = Math.random().toString(36).substring(2, 10);

            const report = `Watermark Verification Report

Report ID: ${reportId}
Project: ${repo}
Issue Number: #${context.issue.number}
Generated At (UTC): ${new Date().toUTCString()}


水印信息
- Watermark Content: \`${watermark}\`
- Verification Hash: \`${hash}\`
- Verification URL: [${verifyUrl}](${verifyUrl})
- Validity: Valid (GitHub-native watermark)


支持项目
这个工具完全免费开源，若对你有帮助，欢迎自愿赞助：
[GitHub Sponsors - 8786cod](https://github.com/sponsors/8786cod)`;

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: report
            });
